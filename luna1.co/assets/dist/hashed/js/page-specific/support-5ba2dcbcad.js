var AsanaSupport={$home:$(".support-home"),$flows:$(".support-flow"),$learnings:$(".supportLearning"),$activeFlow:null,activeFlow:null,$activeLearning:null,activeLearning:null,$searchResults:$(".searchResults"),$breadcrumbs:$(".supportBreadcrumbs"),$flowCta:null,$mainFlowContainers:$(".supportHeader, .support-home, .support-flows"),$postFlowContainer:$(".support-post-auth-pages"),$postFlowPages:$(".postAuthPage"),activeFlowExists:null,activeLearningExists:null,ctaIsFlowCta:null,setDynamicProperties:function(){this.$activeFlow=$("[data-flow].-is-active"),this.activeFlow=this.$activeFlow.attr("data-flow"),this.$activeLearning=$("[data-learning].-is-active"),this.activeLearning=this.$activeLearning.attr("data-learning"),this.$flowCta=this.$activeFlow.find(".supportOptions-cta-wrapper"),this.activeFlowExists=this.$activeFlow.length,this.activeLearningExists=this.$activeLearning.length,this.ctaIsFlowCta=this.$flowCta.hasClass("-flow-active")},deactivate:function(t){t.removeClass("-is-active")},activate:function(t,a){a&&(t=t.filter(a)),t.addClass("-is-active")},show:function(t){t.removeClass("-is-hidden")},hide:function(t){t.addClass("-is-hidden")},scrollToTop:function(){$(window).scrollTop(0)},changePage:function(){this.togglePostAuthPage(),this.emptySeachResults(),this.setDynamicProperties(),this.optionallyDisplayCta(),this.refreshBreadcrumbs(),this.scrollToTop()},activateHome:function(){this.deactivate(this.$flows),this.deactivate(this.$learnings),this.activate(this.$home),this.changePage()},activateFlow:function(t){var a=t?"[data-flow="+t+"]":"";this.deactivate(this.$home),this.deactivate(this.$learnings),this.activate(this.$flows,a),this.changePage()},activateLearning:function(t){var a=t?"[data-learning="+t+"]":"";this.deactivate(this.$learnings),this.activate(this.$learnings,a),this.changePage()},togglePostAuthPage:function(t){var a=t?"[data-post-auth-page="+t+"]":"";t?(this.hide(this.$mainFlowContainers),this.show(this.$postFlowContainer),this.activate(this.$postFlowPages,a)):(this.show(this.$mainFlowContainers),this.hide(this.$postFlowContainer),this.deactivate(this.$postFlowPages)),this.scrollToTop()},optionallyDisplayCta:function(){this.$searchResults.children().length||this.activeLearningExists||this.activeFlowExists&&this.ctaIsFlowCta?this.activate(this.$flowCta):this.deactivate(this.$flowCta)},refreshBreadcrumbs:function(){var t=this.$activeFlow.attr("data-flow"),a=this.$activeFlow.attr("data-flow-crumb");if(activeLearning=this.$activeLearning.attr("data-learning"),initialCrumb=this.createBreadcrumb($(".supportHeader-headline").text(),"activateHome()",!0),a=this.createBreadcrumb(a,"activateFlow('"+t+"')"),learningCrumb="",t){if(this.activate(this.$breadcrumbs),activeLearning){var e=$('[data-card="'+activeLearning+'"]').find(".supportCard-text").text();learningCrumb=this.createBreadcrumb(e,"activateLearning('"+activeLearning+"')")}var i=initialCrumb+a+learningCrumb;this.$breadcrumbs.each((function(t){$(this).html(i)})),this.activate($(".supportBreadcrumb:last-child"))}else this.$breadcrumbs.each((function(t){$(this).html("")})),this.deactivate(this.$breadcrumbs)},createBreadcrumb:function(t,a,e){return(e?"":'<span class="supportBreadcrumb-delimeter"><svg class="supportBreadcrumb-delimeter-icon icon-svg icon-svg--right-caret icon--gray" width="10" height="10" viewBox="0 0 32 32" preserveAspectRatio="xMinYMin">                    <use xmlns: xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/svg/icons.svg#icon--right-caret"></use>                  </svg></span>')+'<a class="supportBreadcrumb" onclick="AsanaSupport.'+a+'">'+t+"</a>"},setResults:function(t){var a=AsanaI18n.getCurrentPageLanguage(),e=SwiftypeKeys[a],i="https://api.swiftype.com/api/v1/public/engines/search?q="+encodeURIComponent(t)+"&engine_key="+encodeURIComponent(e);$.ajax({url:i,type:"GET",success:function(t){var a=AsanaSupport;if(a.$searchResults.html(""),t.info.page.query){var e=t.record_count>=10?10:t.record_count,i=$('<p class="searchResults-summary"></p>').text("Showing "+e+' results for "'+t.info.page.query+'"');a.$searchResults.append(i),t.records.page.slice(0,10).forEach((function(t){var e,i=t.highlight.body||t.highlight.sections+"<br>"+((e=t.body).length>400?e.slice(0,400)+"...":e),s=filterXSS(i),o=$('<div class="searchResult"></div>'),n=$('<a class="searchResult-title"></a>');n.text(t.title),n.attr("href",t.url);var r=$('<p class="searchResult-body"></p>');r.html(s),o.append(n),o.append(r),a.$searchResults.append(o)}))}else a.hideResults();a.optionallyDisplayCta()},error:function(t,a,e){}})},showResults:function(){this.show(this.$searchResults)},hideResults:function(){this.hide(this.$searchResults)},emptySeachResults:function(){this.$searchResults.html(""),this.hideResults()},getAppClientId:function(){var t="507317497928300",a="521888353132623",e="521888353132625",i="";return"local.asana.com"===window.location.hostname?i=t:"oban.luna3.co"===window.location.hostname||"www2.asana.com"===window.location.hostname?i=a:"asana.com"===window.location.hostname&&(i=e),i},redirectUser:function(){if("im-having-trouble-with"===this.activeFlow)AsanaSupport.createForm(),AsanaSupport.togglePostAuthPage("contact-us");else{var t=window.location.origin+"/support",a=JSON.stringify({flow:this.activeFlow||"",learning:this.activeLearning||"",post_auth:!0}),e=AsanaHelpers.appUrl("/-/oauth_authorize?response_type=id_token&scope=openid%20profile%20email&client_id=")+this.getAppClientId()+"&state="+encodeURIComponent(a)+"&redirect_uri="+encodeURIComponent(t);window.location.href=e}},detectOS:function(t){var a=t.match(/\(Mac[^\)]*/)&&t.match(/\(Mac[^\)]*/)[0]+")",e=t.match(/\(Win[^\)]*/)&&t.match(/\(Win[^\)]*/)[0]+")";return a||e},detectBrowser:function(t){var a=t.match(/Firefox[^\s]*/)&&t.match(/Firefox[^\s]*/)[0],e=t.match(/Chrome[^\s]*/)&&t.match(/Chrome[^\s]*/)[0],i=t.match(/Version\/[^\s]*/)&&"Safari "+t.match(/Version\/[^\s]*/);return a||e||i},createForm:function(t){var a=t&&t.name?filterXSS(t.name):"",e=t&&t.email?filterXSS(t.email):"",i=a&&e?80216535537153:73134872137154,s=navigator.userAgent,o=AsanaSupport.detectBrowser(s),n='<iframe id="JotFormIFrame-'+i+'" onload="window.parent.scrollTo(0,0)" allowtransparency="true" src="https://form.jotform.com/'+i+"?name="+a+"&email="+e+"&os="+AsanaSupport.detectOS(s)+"&browser="+o+'" frameborder="0" style="width: 1px; min-width: 100%; height:1600px; border:none;" scrolling="no"> </iframe>';$('[data-post-auth-page="contact-us"] .jotform-form').html(n)},isStagingServer:function(){return!!window.location.hostname.match(/luna3.co/)},toggleLoader:function(t){var a=t?"addClass":"removeClass";$(".support-loading-indicator")[a]("-is-hidden"),t||setTimeout((function(){AsanaSupport.toggleLoader("hide")}),1e4)},paramsRedirect:function(t){if(t.flow&&this.activateFlow(t.flow),t.learning&&this.activateLearning(t.learning),t.post_auth){var a=AsanaHelpers.isProduction(),e=a?AsanaHelpers.appUrl("/-/marketing_info"):"https://private-ae389-marketingdata.apiary-mock.com/marketing_info";function i(t){var a=t.user_in_premium_domain?"contact-us":"community";"contact-us"!==a&&AsanaSupport.toggleLoader("hide"),AsanaSupport.togglePostAuthPage(a)}a?AsanaAppUserInfo.get(i,(function(){AsanaSupport.toggleLoader("hide"),AsanaSupport.togglePostAuthPage("contact-us")})):$.ajax({url:e}).done((function(t){i(t)}))}},createAndFillForm:function(t){if(t){var a=JSON.parse(window.atob(t.split(".")[1]));AsanaSupport.toggleLoader("hide"),AsanaSupport.createForm(a)}else AsanaSupport.toggleLoader("hide"),AsanaHelpers.showModal("re-authenticate")},clearUrlFragment:function(){window.location.replace("#"),"function"==typeof window.history.replaceState&&history.replaceState({},"",window.location.href.slice(0,-1))},resumeFromUrlFragment:function(){if(AsanaStorage.getCookie("is_logged_in")||this.isStagingServer()){var t=AsanaHelpers.getParamsFromUrlFragment();if(AsanaSupport.clearUrlFragment(),t.state){var a=JSON.parse(t.state);this.paramsRedirect(a)}t.id_token?this.createAndFillForm(t.id_token):AsanaSupport.toggleLoader("hide")}else AsanaSupport.toggleLoader("hide")},activateForm:function(){$(".postAuthPage-text").addClass("-is-hidden"),$(".jotform-form").removeClass("-is-hidden")}};$(window).load((function(){"#i-want-to-learn"===window.location.hash?AsanaSupport.redirectUser():"#im-having-trouble-with"===window.location.hash&&(AsanaSupport.activeFlow="im-having-trouble-with",AsanaSupport.redirectUser()),AsanaSupport.setDynamicProperties(),AsanaSupport.resumeFromUrlFragment(),$(".searchbar-input").on("keyup fieldClear",(function(t){var a=filterXSS(t.target.value);13!==t.keyCode&&a.length||(AsanaSupport.activeLearning&&AsanaSupport.activateFlow(AsanaSupport.activeFlow),AsanaSupport.setResults(a),a.length?AsanaSupport.showResults():AsanaSupport.hideResults())}))}));