var AsanaJobs={state:{hash:""},hash:{saveHash:function(){AsanaJobs.state.hash=window.location.hash.replace("#","")},updateHash:function(e){window.location.hash=e},returnHash:function(){return AsanaJobs.state.hash},compareHash:function(e,t){if(e===t)return!0},navigateToHash:function(e){window.setTimeout((function(){AsanaJobs.hash.updateHash(e),$(window).scrollTop($(window).scrollTop()+300)}),500)}},appendSubDepToDom:function(e){if(e.jobs.length>0)try{var t=filterXSS(e.parent_id),n=filterXSS(e.id),i=filterXSS(e.name),o=$('<div id="child-dep-'+n+'" class="jobs-listings"></div>'),s=$('<div id="'+i.toLowerCase().replace("&","").split(" ").join("-")+'" class="jobs-listings-team">'),a=$("<h4></h4>"),l=$('<div class="jobs-listings-wrapper"></div>');a.text(i);var r=i.toLowerCase().replace("&","").split(" ").join("-");$(s).append(a),$(o).append(s),$(o).append(l),$("#"+t).append(o),this.appendJobsFromThisTeam(n,r)}catch(e){Bugsnag.notifyException(e)}},appendJobsFromThisTeam:function(e,t){$.get("https://api.greenhouse.io/v1/boards/asana/departments/"+e,(function(){})).done((function(n){n.jobs.length>0&&n.jobs.forEach((function(n){var i=filterXSS(n.id),o=filterXSS(n.title),s=filterXSS(n.location.name),a=s.toLowerCase().split(" ").join("-").replace(/,-/g," "),l=o.toLowerCase().replace(/& |, |- /g,"").replace(/[^a-z]/g,"-"),r=$('<a href="'+("/jobs/apply/"+i+"/"+l)+'" class="jobs-listing"></a>'),c=$('<div class="jobs-listing-title"></div>'),d=$("<strong></strong>"),h=$('<div class="jobs-listing-location"></div>'),b=$('<span class="icon icon--right-caret"></span>');r.addClass(a),d.text(o),h.text(s),$(c).append(d),$(r).append(c),$(r).append(h),$(r).append(b),$(r).addClass(t),$("#child-dep-"+e+" .jobs-listings-wrapper").append(r)}))})).then((function(e){var t=e.name.toLowerCase().replace(/& |, |- /g,"").replace(/[^a-z]/g,"-"),n=AsanaJobs.hash.returnHash();AsanaJobs.hash.compareHash(t,n)&&AsanaJobs.hash.navigateToHash(n)})).fail((function(){console.log("Couldn't fetch job from Greenhouse")}))},returnListingType:function(){var e,t=document.querySelectorAll(".gh-section"),n=document.querySelectorAll(".jobs-office");return e=t.length>1?"all":1===t.length?"department":"single",n.length>0&&(e="office"),e},fetchGreenhouse:function(e,t,n){$.get("https://api.greenhouse.io/v1/boards/asana/"+e,(function(){})).done((function(e){"object"==typeof e&&e.hasOwnProperty("departments")&&t&&t(e)})).fail((function(){Bugsnag.notify("Failed to request"+e+"to Greenhouse"),n&&n()}))},returnDepartmentJobs:function(){var e=document.querySelector(".gh-section").getAttribute("id");this.fetchGreenhouse("departments",(function(t){var n=t.departments.filter((function(t){return t.parent_id==Number(e)})),i=0;n.forEach((function(e){e.hasOwnProperty("jobs")&&(i+=e.jobs.length)})),0!==n.length&&0!==i||$(".gh-section").append('<div class="jobs-listings-team"><h4>Wish this were a match, but we don\'t have any open roles right now. Please check back again soon!</h4></div>'),n.forEach((function(e){AsanaJobs.appendSubDepToDom(e)}))}))},returnOfficeJobs:function(){var e=document.querySelector(".gh-section").getAttribute("id");this.fetchGreenhouse("offices/"+e,(function(e){var t=e.departments,n=0,i=$(".gh-section");t.forEach((function(e){if(e.jobs.length>0){n++;var t=e.name.toLowerCase().split(" ").join("-"),o=$('<div class="jobs-listings"></div>'),s=$('<div id="'+t+'" class="jobs-listings-team"><h4>'+e.name+"</h4></div>"),a=$('<div id="child-'+e.id+'" class="jobs-listings"></div>');$(a).append(s)}e.jobs.forEach((function(e){var n=filterXSS(e.id),s=filterXSS(e.title).toLowerCase().replace(/& |, |- /g,"").replace(/[^a-z]/g,"-"),l=$('<a href="'+("/jobs/apply/"+n+"/"+s)+'" class="jobs-listing '+t+'"></a>'),r=$('<div class="jobs-listing-title">'+e.title+"</div>"),c=$('<div class="jobs-listing-location">'+e.location.name+"</div>"),d=$('<span class="icon icon--right-caret"></span>');$(l).append(r,c,d),$(o).append(l),$(a).append(o),$(i).append(a)}))})),0===n&&(i.append('<div class="jobs-listings-team"><h4>Wish this were a match, but we don\'t have any open roles right now. Please check back again soon!</h4></div>'),$(".jobs-filter-select").prop("disabled",!0))}))},returnAllJobs:function(){AsanaJobs.hash.saveHash(),AsanaJobs.hash.updateHash(""),this.fetchGreenhouse("departments",(function(e){e.departments.filter((function(e){return e.child_ids.length>0})).forEach((function(t){t.child_ids.forEach((function(t){var n=e.departments.filter((function(e){return e.id==t}));AsanaJobs.appendSubDepToDom(n[0])}))}))}))},returnSingleJob:function(){var e,t=window.location.pathname.split("/")[1];(e=["es","de","fr","ja","pt"].indexOf(t)>-1?Number(window.location.pathname.split("/")[4]):Number(window.location.pathname.split("/")[3]))&&this.fetchGreenhouse("jobs/"+e,(function(e){var t=$(".jobs-single-text").html(e.content).text(),n={45380:["Business & Marketing","business"],45381:["Engineering & Data","engineering"],45379:["General & Administrative","internal"],45382:["Product & Design","product"],45384:["Interns & Early Career","university-recruiting"]},i=n[e.departments[0].parent_id][0]||"",o=n[e.departments[0].parent_id][1]||"";document.title=e.title+" | Careers at Asana",$(".jobs-single-headline").text(e.title),$(".jobs-single-subhead").text(e.location.name),$(".jobs-single-text").html(t),$("a.jobs-single-button").attr("href",e.absolute_url),$("a.breadcrumbs-link.department").text(i),$("a.breadcrumbs-link.department").attr("href","/jobs/"+o),$(".breadcrumbs-link.title").text(e.title)}),(function(){"/jobs"!==window.location.pathname&&(window.location.pathname="/jobs/all")}))},init:function(){var e=this.returnListingType();"department"===e?this.returnDepartmentJobs():"office"===e?this.returnOfficeJobs():"all"===e?this.returnAllJobs():"single"===e&&this.returnSingleJob()}};window.onload=function(){AsanaJobs.init()};var jobsNav=document.querySelector(".jobsNav"),jobsSubNav=document.querySelector(".jobsNav nav"),mobileNavToggle=document.getElementById("mobileNavToggle"),navToggle=function(e){e.preventDefault(),document.querySelector("#jobsNavToggle").classList.toggle("-is-active"),document.querySelector(".jobsNav nav").classList.toggle("-mobile-nav-active"),document.getElementsByTagName("html")[0].classList.toggle("-no-scroll")};document.addEventListener("DOMContentLoaded",(function(){document.querySelector("#jobsNavToggle").addEventListener("click",navToggle)}));var jobsSubNavToggleMobile=document.getElementsByClassName("jobsSubNavToggleMobile");function toggleItem(){var e=this.parentElement.nextElementSibling;this.classList.toggle("-is-active"),this.parentElement.classList.toggle("-is-active"),e.classList.toggle("-mobile-nav-active"),this.parentElement.parentElement.previousElementSibling.classList.toggle("no-border")}function closeJobsNav(){jobsSubNav.classList.contains("-mobile-nav-active")&&(jobsSubNav.classList.toggle("-mobile-nav-active"),document.querySelector("#jobsNavToggle").classList.toggle("-is-active"))}document.addEventListener("DOMContentLoaded",(function(){for(var e=0;e<jobsSubNavToggleMobile.length;e++)jobsSubNavToggleMobile[e].addEventListener("click",toggleItem,!1)})),document.addEventListener("DOMContentLoaded",(function(){mobileNavToggle.addEventListener("click",closeJobsNav)}));var jobsFilterAll=document.querySelector(".jobs-filter"),jobsFilterOffice=document.querySelector(".jobs-filter.jobs-office-filter"),jobsFilterTeam=document.querySelector(".jobs-filter.jobs-team-filter"),jobsOfficeListing=document.querySelector("#jobs"),jobsOfficeClass=document.querySelectorAll(".jobs-office"),navGlobal=document.querySelector(".siteHeader"),navGlobalHeight=navGlobal.getBoundingClientRect().height;function isInViewport(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}window.addEventListener("scroll",(function(e){(document.documentMode||/Edge/.test(navigator.userAgent)||/Edg/.test(navigator.userAgent))&&(!isInViewport(jobsNav)&&window.innerWidth>=1200&&jobsNav.getBoundingClientRect().top<=10?jobsNav.classList.add("fixed-nav"):(window.pageYOffset<=navGlobalHeight||window.innerWidth<=1200)&&jobsNav.classList.remove("fixed-nav")),window.location.href.indexOf("jobs/all")>-1&&(!isInViewport(jobsFilterAll)&&window.innerWidth>=1200&&jobsFilterAll.getBoundingClientRect().top<=100?jobsFilterAll.classList.add("fixed-nav"):(window.pageYOffset<=400||window.innerWidth<=1200)&&jobsFilterAll.classList.remove("fixed-nav")),(jobsOfficeClass.length>0||window.location.href.indexOf("engineering")>-1||window.location.href.indexOf("product")>-1||window.location.href.indexOf("internal")>-1||window.location.href.indexOf("business")>-1||window.location.href.indexOf("university")>-1)&&(jobsOfficeListing.getBoundingClientRect().top<=100&&window.innerWidth>=1200?(jobsFilterAll.classList.remove("hide-nav"),jobsFilterAll.classList.add("fixed-nav")):(jobsFilterAll.classList.add("hide-nav"),jobsFilterAll.classList.remove("fixed-nav")))}),!1),$(document).ready((function(){var e=0;setTimeout((function t(){e++;var n=$(".jobs-listing").length;0===n&&e<=2?setTimeout(t,3e3):$(".jobs-num").text(n)}),2e3),$(".jobs-filter-select").change((function(){$("#jobs .jobs-container, #jobs-listings .jobs-container").find(".no-jobs-msg").remove();var e="",t=!0;if($(".jobs-filter-select").each((function(){var n=$(this).val();e+="."+n,t=!1,$(".gh-section").show(),$(".jobs-group-header, .jobs-group-subheader, .gh-section, .jobs-listing, .jobs-listings-team").show()})),t)$(".jobs-listing").show(),$(".jobs-listings-team").show();else{if($(".jobs-listing").hide(),$(e).show(),!$("body").hasClass("jobs-team")){$(".jobs-listings-team").hide();var n=$("#department").val();$("#"+n).show(),"jobs-listing"===n&&$(".jobs-listings-team").show()}$(".jobs-listings-team").each((function(){0===$(this).next().children(":visible").length&&$(this).hide()})),$(".gh-section").each((function(){0===$(this).find(".jobs-listings-team:visible").length&&($(this).hide(),$(this).prev().hide(),$(this).prev().prev().hide())}))}var i=$("#jobs-listings").find(".jobs-listing:visible").length,o=$('<h4 class="no-jobs-msg">Wish this were a match, but we don\'t have any open roles right now. Please check back again soon!</h4>');0===i&&$("#jobs .jobs-container, #jobs-listings .jobs-container").append(o)})),setTimeout((function(){$(".reset-filter").on("click",(function(){var e=this.id;"all-locations"===e?$("#location").val("jobs-listing").change():"all-teams"===e?$("#department").val("jobs-listing").change():($("#department").val("jobs-listing").change(),$("#location").val("jobs-listing").change())}))}),2e3)}));