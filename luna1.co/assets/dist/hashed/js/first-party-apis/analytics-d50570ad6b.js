var AsanaAnalytics={KEYS:{ENCRYPTED_USER_ID:"cd3",GOOGLE_ANALYTICS_ID:"cd4"},init:function(){window.dataLayer=window.dataLayer||[];var t=AsanaStorage.getCookie("_ga"),n=AsanaStorage.getEncryptedUserId();t&&AsanaAnalytics.setGoogleAnalyticsId(t),n?AsanaAnalytics.setEncryptedUserId(n):AsanaAppUserInfo.get((function(t){AsanaAnalytics.setEncryptedUserId(t.encrypted_user_id),AsanaStorage.setEncryptedUserId(t.encrypted_user_id)}))},setGoogleAnalyticsId:function(t){var n={};n[this.KEYS.GOOGLE_ANALYTICS_ID]=t,window.dataLayer.push(n)},setEncryptedUserId:function(t){var n={};n[this.KEYS.ENCRYPTED_USER_ID]=t,window.dataLayer.push(n)},initGTM:function(){!function(t,n,a,e,o){t[e]=t[e]||[],t[e].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=n.getElementsByTagName(a)[0],r=n.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-58G7LFP",i.parentNode.insertBefore(r,i)}(window,document,"script","dataLayer")},trackGTM:function(t,n){try{n?"string"==typeof t&&"[object Object]"===Object.prototype.toString.call(n)&&0!==Object.keys(n).length?dataLayer.push(Object.assign({},{event:t},n)):Bugsnag.notify("AsanaAnalytics.trackGTM only accepts one argument of type <string>, one argument of type <object>, or two arguments of type [<string>, <object>]."):"string"==typeof t?dataLayer.push({event:t}):dataLayer.push(t)}catch(t){Bugsnag.notifyException(t,"Failed to push an event to the GTM data layer.")}},buildCustomGtmEventName:function(t){var n={};for(var a in t)n[a]=function(t){return t.split(" ").join("")}(function(t){var n=t.split(" "),a=[];return n.forEach((function(t){if(t[0]){var n="";t.split("").forEach((function(t,a){var e=0===a?t.toUpperCase():t.toLowerCase();n+=e})),a.push(n)}})),a.join(" ")}(t[a].trim()));return n.action=n.action||"",n.page=n.page||"",n.subAction=n.subAction?"-"+n.subAction:"",n.subLocation=n.subLocation?"-"+n.subLocation:"",n.action+n.subAction+"@"+n.page+n.subLocation},isGtmDomLoaded:function(){return window&&window.google_tag_manager&&window.google_tag_manager.dataLayer&&window.google_tag_manager.dataLayer.gtmDom},trackGtmWithEventData:function(t,n,a){AsanaAnalytics.trackGTM(t,{eventCategory:t,eventAction:n,eventLabel:a})},trackSignupEventsInGtm:{pathToLocationMap:{"/pricing":"Pricing","/create-account":"Create Account"},hashesToSublocationMap:{"#signup":"Signup","#buy-premium":"Buy Premium","#buy-business":"Buy Business"},sessionStorageKey:"gtmSignupData",init:function(t,n,a,e){var o=JSON.parse(AsanaStorage.getFromSessionStorage(this.sessionStorageKey));if(AsanaStorage.removeFromSessionStorage(this.sessionStorageKey),t&&n&&o){var i=this.createEventLabel(n,o.path,a,o.hash);if(i){var r={eventCategory:t,eventAction:n,eventLabel:i};if(e){var s=this.getCurrentTime()-o.submissionTime;r.eventValue=s}AsanaAnalytics.trackGTM(t,r)}}},createEventLabel:function(t,n,a,e){var o=this.getLocationFromPath(n);if(o){var i=this.hashesToSublocationMap[e];return AsanaAnalytics.buildCustomGtmEventName({action:t,page:o,subAction:a||"",subLocation:i||""})}},storeGtmSignupSubmissionData:function(){var t={};t.path=window.location.pathname,t.hash=window.location.hash,t.submissionTime=this.getCurrentTime(),AsanaStorage.setToSessionStorage(this.sessionStorageKey,JSON.stringify(t))},getCurrentTime:function(){return(new Date).getTime()},getLocationFromPath:function(t){var n=Object.keys(this.pathToLocationMap).filter((function(n){return new RegExp(n,"g").test(t)}));return this.pathToLocationMap[n[0]]}},stringToArrayBuffer:function(t){for(var n=new ArrayBuffer(t.length),a=new Uint8Array(n),e=0,o=t.length;e<o;e++)a[e]=t.charCodeAt(e);return n},hashString:function(t,n){return new Promise((function(a,e){var o=AsanaAnalytics.stringToArrayBuffer(n),i=(new TextEncoder).encode(t);window.crypto.subtle.importKey("raw",o,{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"]).then((function(t){return window.crypto.subtle.sign("HMAC",t,i).then((function(t){var n=Array.from(new Uint8Array(t)).map((function(t){return t.toString(16).padStart(2,"0")}));a(n.join(""))}))})).catch((function(t){Bugsnag.notify("[hashString] Failed to hash string")}))}))},getIpAddressFromGTM:function(){if(window.dataLayer)for(var t={},n=0;n<window.dataLayer.length;n++)for(var a in t=window.dataLayer[n])if(t[a]&&t[a].ip)return t[a].ip},sendHashedIpAddressToGTM:function(){if(window.dataLayer){var t=this.getIpAddressFromGTM();if(t){this.hashString(t,"srnbyhsomm9iqk5h2z39uyl9h").then((function(t){AsanaAnalytics.trackGTM({hashedIP:t})})).catch((function(t){Bugsnag.notify("[sendHashedIpAddressToGTM] Failed to push hashed IP to GTM dataLayer")}))}else Bugsnag.notify("[sendHashedIpAddressToGTM] Failed to get IP from GTM dataLayer")}}};AsanaAnalytics.init();